# 基本設計

設計中、開発中に限らず今後必要になる機能と基本設計を記載する。

- 認証
- ユーザ(Admin のみ)
- ダッシュボード
- 発注管理
- クライアント管理
- 製品管理
- 部品管理

## 認証

今後 Google アカウントでのログインできるようにするため、部分については AWS Cognito を利用する。  
初期開発に応じては、メールアドレスとパスワードでのみの登録とする。

認可の部分やユーザーの名前管理、組織管理などは Cognito の uuid を使って DB 側で管理をする。

ログイン画面にはメールアドレスとパスワードの入力欄のみを表示する。  
ログインに成功すると、ワンタイムパスワードを入力する画面を表示する。  
常に二段階認証をオンにし、6 桁の数字を必ずいれるようにする。

## ユーザ(Admin のみ)

**ページ一覧**

- ユーザ一覧
- ユーザ登録
- ユーザ編集

Ph1 ではユーザは必ず１つだけの組織に所属する必要がある。  
今後、複数組織に登録できるような改修を行う必要がある。  
ユーザーを組織に招待する機能。

組織に属する個人が自分のユーザ情報を変更することはできない設定とする。
Admin 権限のみ編集が可能。

### ユーザ一覧

テーブル表示とする。
**テーブルの 1 行に必要な項目**

- 名前
- メールアドレス
- 権限
- ユーザ有効状態(招待メールからアカウントを有効にしたかどうか)
- 編集ボタン(ユーザ編集画面遷移)

**その他・必要な機能**

- ユーザ登録ページ遷移

### ユーザ登録

**登録に必要な項目**

- 名前
- メールアドレス
- 権限

ユーザは組織の Admin から招待を受けることでユーザを作成することができる。  
追加したいユーザのメールアドレス宛に招待リンクを送り、リンク先にアクセスする。  
リンク先にアクセスするとパスワードを設定する画面が表示されるので、パスワードを設定するとログイン画面からログインするように案内を表示する。

### ユーザ編集

基本的にはユーザ登録と同じ。
招待メールの再送ボタンとユーザの削除ボタンだけ追加する。

## ダッシュボード

部品数から各製品が何台作れるかを計算し表示する。  
今発注されている分の製品数分の部品数を引いた部品数を表示する。  
足りていない部品を表示する。  
各製品何台発注が来ているかのサマリを表示する。  
汎用メッセージ欄を表示する。  
すべてカード表示の想定。

各一覧ページへは、サイドバーから遷移を想定。

## 発注管理

**ページ一覧**

- 発注一覧
- 発注登録
- 発注編集

### 発注一覧

どのクライアントからどの製品が何台発注されているかを表示する。  
初期登録時は受注、出荷済みの二種類の状態をもつ。  
状態は増える可能性があるためフラグを追加できる必要がある。

一覧表示は、テーブルでの表示とする。

**テーブルの 1 行に表示する項目**

- クライアント名
- 製品
- 数
- 出荷予定日
- 出荷日
- 備考欄
- 出荷済み処理ボタン
- 編集ページ遷移ボタン

**その他・必要な機能**

- 発注登録ページ遷移
- 出荷済み処理
- 出荷済み表示トグル

出荷済み処理は、一覧表示画面においても操作可能とする。  
出荷済み処理は、出荷済み処理をした日時を持つカラムに日時を追加することをフラグとする。  
削除は誤って操作してしまう場合を考え、編集画面でのみの操作とする。

誤って出荷済みとしてしまった場合は、編集画面に入って出荷済み解除ボタンを押す。

絞り込み機能は、検索までいれると複雑になるため出荷予定日昇順 + 未出荷のもののみで初期表示。出荷済みのものを表示する場合はトグルボタンを操作する。  
Ph1 では表示順は固定表示とする。

### 発注登録

**登録に必要な項目**

- クライアント(ドロップダウンから選択する)
- 製品(ドロップダウンから選択する)
- 数
- 出荷予定日(カレンダーから選択する)
- 備考

クライアント、製品はドロップダウンメニューから選べるようにする。  
Ph1 では存在しないクライアントや製品は登録できないようにする。

Ph2 では登録されていないクライアントや製品が登録できないと不便なため、その他選択肢を用意して、備考欄必須で登録可とする対応をいれる。

### 発注編集

登録画面の流用で基本的には OK。  
加えて出荷済みボタン、出荷済み解除ボタン、削除ボタンを設置する。
削除処理はソフトデリートとして deleted_at をテーブルに登録する。
排他制御は Ph1 では考慮しない。

## クライアント管理

**ページ一覧**

- クライアント一覧
- クライアント登録
- クライアント編集

### クライアント一覧表示

一覧表示は、テーブルでの表示とする。

**テーブルの 1 行に表示する項目**

- クライアント名
- メールアドレス
- 備考欄
- 編集ページ遷移ボタン

**その他・必要な機能**

- クライアント登録ページ遷移

## 部品管理

**ページ一覧**

- 部品一覧
- 新規部品情報登録
- 部品情報編集
- 部品補充・廃棄
- 部品数増減履歴(Ph1 では対応しない)

### 部品一覧

一覧表示は、テーブルでの表示とする。

**テーブルの 1 行に表示する項目**

- 部品名
- 個数
- 単価(税込み)
- 備考欄
- 補充画面遷移ボタン
- 部品情報編集画面遷移ボタン

**その他・必要な機能**

- 新規部品登録ページ遷移
- 部品増減履歴ページ遷移

部品の個数については、部品数増減履歴から計算したものを表示する。

### 新規部品情報登録

部品マスタという扱い。  
ここには部品の情報のみをもつ。  
現在の数量は、補充後の計算値として取得するためこのテーブルには持たない。

**登録に必要な項目**

- 部品名
- 部品メーカー
- カテゴリ(ドロップダウンから選択する)
- 備考

### 部品情報編集

基本的に登録と同じ。
部品を削除するとややこしいので削除はできないようにする。

### 部品補充・廃棄

**登録に必要な項目**

- 部品名(ドロップダウンから選択する)
- 補充・廃棄トグル
- 数量
- 備考

部品は補充という形で購入履歴を残していくような形にする。  
理由としては以下のようなものがある。

- 棚卸しの際に必要となるので、購入した際の金額と日時はデータとして持ちたい。最終仕入原価法で計算することができるようにする。
- 外貨か日本円かが場合によって異なることがある。
- 部品の値上がりなどの情報を残しておきたい
- 部品数を物理的に更新してしまうと誤って変な値で更新してしまった場合の取り返しがつきにくい

これによって、部品数や補充の回数が増えると 一覧表示時に DB の読み込み負荷が増える可能性があるため、読み込み負荷については気をつけておく必要がある。

部品が壊れてしまった等は廃棄を選択し値を入力することで、部品の廃棄を表す。
